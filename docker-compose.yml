version: '3.8'

services:
  ferrous-dns:
    image: ghcr.io/andersonviudes/ferrous-dns:latest
    container_name: ferrous-dns
    restart: unless-stopped

    ports:
      - "53:53/udp"
      - "53:53/tcp"
      - "8080:8080"

    volumes:
      - ferrous-data:/data
      - ./ferrous-dns.toml:/data/config/ferrous-dns.toml:ro

    environment:
      - FERROUS_CONFIG=/data/config/ferrous-dns.toml
      - FERROUS_DNS_PORT=53
      - FERROUS_WEB_PORT=8080
      - FERROUS_BIND_ADDRESS=0.0.0.0
      - FERROUS_DATABASE=/data/db/ferrous.db
      - FERROUS_LOG_LEVEL=info
      - RUST_LOG=info
      - TZ=America/Sao_Paulo

    healthcheck:
      test: ["/usr/local/bin/ferrous-dns", "--version"]
      interval: 5s
      timeout: 3s
      start_period: 5s
      retries: 60

volumes:
  ferrous-data:
    driver: local
